<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>WCH</title>

    <link href="styles.css" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">

</head>

<body>

    <nav id="navigation" class="sidebar">
        <ul>
            <li>
                <a href="#">
                        <i class="fa fa-trophy fa-2x"></i>
                        <span class="nav-text">
                            Champions
                        </span>
                    </a>

            </li>

            <li>
                <a href="#">
                        <i class="fa fa-sitemap fa-2x"></i>
                        <span class="nav-text">
                            Knockout Stages
                        </span>
                    </a>

            </li>
            <li>
                <a href="#">
                        <i class="fa fa-futbol fa-2x"></i>
                        <span class="nav-text">
                            Top Scorers
                        </span>
                    </a>

            </li>
            <!--
                  <li>
                    <a href="#">
                        <i class="fa fa-tv fa-2x"></i>
                        <span class="nav-text">
                        ???
                        </span>
                    </a>

                </li>
                  <li>
                    <a href="#">
                        <i class="fa fa-home fa-2x"></i>
                        <span class="nav-text">
                            Home
                        </span>
                    </a>


                </li>
                -->
        </ul>
        <a href="#" class="sidebar-toggle" onclick="addClass()"></a>
    </nav>


    <div id="home">Home</div>
    <div class="row" id="main-container">
        <div class="column">
            <div id="home-team">
                <div id="loaderA">
                    <div class="dot dot1"></div>
                    <div class="dot dot2"></div>
                    <div class="dot dot3"></div>
                    <div class="dot dot4"></div>
                </div>
                <div id="home-country-code"></div>
                <div id="home-country-flag">
                    <!--            <img src="countryFlags/ARG.png" class="flags">-->
                </div>
                <div id="home-score"></div>
            </div>
        </div>

        <div class="column" id="cup">
            <img src="wctrophy.png" class="trophy">
        </div>

        <div class="column">
            <div id="away-team">
                <div id="loaderB">
                    <div class="dot dot1"></div>
                    <div class="dot dot2"></div>
                    <div class="dot dot3"></div>
                    <div class="dot dot4"></div>
                </div>
                <div id="away-country-code"></div>
                <div id="away-country-flag">
                    <!--            <img src="countryFlags/URU.png" class="flags">-->
                </div>
                <div id="away-score"></div>


            </div>
        </div>
    </div>
    <div id="output">


    </div>
    <div id="search-form">
        <form id="cform" action="/getWorldCupDetails" method="GET">
            <select id="finalists" name="year">
                <option value="1930">Uruguay - 1930</option>
                <option value="1934">Italy - 1934</option>
                <option value="1938">France - 1938</option>
                <option value="1950">Brazil - 1950</option>
                <option value="1954">Switzerland - 1954</option>
                <option value="1958">Sweden - 1958</option>
                <option value="1962">Chile - 1962</option>
                <option value="1966">England - 1966</option>
                <option value="1970">Mexico - 1970</option>
                <option value="1974">West Germany 1974</option>
                <option value="1978">Argentina - 1978</option>
                <option value="1982">Spain 1982</option>
                <option value="1986">Mexico - 1986</option>
                <option value="1990">Italy - 1990</option>
                <option value="1994">United States - 1994</option>
                <option value="1998">France - 1998</option>
                <option value="2002">South Korea and Japan - 2002</option>
                <option value="2006">Germany - 2006</option>
                <option value="2010">South Africa - 2010</option>
                <option value="2014">Brazil - 2014</option>
                <option value="2018">Russia - 2018</option>
            </select>

            <button>Retrieve data</button>
        </form>
    </div>




    <script>
        function addClass() {
            document.getElementById('navigation').classList.toggle('sidebar-open');
        }

        // Constants used during the AJAX request.
        const DONE = 4;
        const OKAY = 200;
        const ERROR = {
            "message": "The request failed!"
        };

        // Wait for the document to load before binding event handlers further.
        document.addEventListener('DOMContentLoaded', function(e) {

            // Obtain programmatic reference to the important elements of the page.
            var cform = document.getElementById('cform'),
                finalists = document.getElementById('finalists'),
                output = document.getElementById('output'),
                homeTeam = document.getElementById('home-country-code'),
                awayTeam = document.getElementById('away-country-code'),
                homeScore = document.getElementById('home-score'),
                awayScore = document.getElementById('away-score'),
                homeFlag = document.getElementById('home-country-flag'),
                awayFlag = document.getElementById('away-country-flag');

            var a = document.getElementById('loaderA');
            var b = document.getElementById('loaderB');

            var hTeamBox = document.getElementById('home-team');
            var aTeamBox = document.getElementById('away-team');



            // Listen for submission events on the example form.
            cform.addEventListener('submit', function(e) {
                 

                // Programmatically prevent the form from submitting.
                e.preventDefault();
                a.style.display = "table";
                 b.style.display = "table";
// setTimeout(function() {
//                    a.style.display = "table";
//                    b.style.display = "table";
//                }, 200);
                // Create a new XMLHttpRequest object and resolve the target URI.
                var request = new XMLHttpRequest(),
                    target = '/getWorldCupDetails?year=' + finalists.value;

                // Open and send a GET request to the target URI.
                request.open('GET', target);



                output.innerHTML = "";
                homeTeam.innerHTML = "";
                awayTeam.innerHTML = "";
                homeFlag.innerHTML = "";
                awayFlag.innerHTML = "";
                homeScore.innerHTML = "";
                awayScore.innerHTML = "";

                hTeamBox.style.opacity = '0';
                aTeamBox.style.opacity = '0';

                request.send();

                // Listen for changes to the XMLHttpRequest's readyState.
                request.onreadystatechange = function() {

                    // Do nothing until the request is finished.
                    if (request.readyState === DONE) {

                        // Create a div element to hold the output.
                        var div = document.createElement('div');

                        // If the request was successful, append the response.
                        // If not, append a JSON error object.
                        if (request.status === OKAY) {

                            //                                setTimeout(function() { 



                            //                                 hTeamBox.style.opacity = '0';

                            //                                setTimeout(function() {
                            //                                    
                            //                                    output.innerHTML = "";
                            //                                homeTeam.innerHTML = "";
                            //                                awayTeam.innerHTML = "";
                            //                                homeFlag.innerHTML = "";
                            //                                awayFlag.innerHTML = "";
                            //                                homeScore.innerHTML = "";
                            //                                    awayScore.innerHTML = "";
                            //                                }, 800);
                            //                                }, )
                            
//                                            setTimeout(function() {
//      a.style.display = "none";
//                    b.style.display = "none";
//                }, 900);

   
    

                            setTimeout(function() {

                                a.style.display = "none";
                 b.style.display = "none";
                                let dataObj = JSON.parse(request.responseText);
                             
                                homeTeam.innerHTML = dataObj[0].champion_code;
                                awayTeam.innerHTML = dataObj[0].runner_up_code;

                                homeFlag.innerHTML = "<img src='countryFlags/" + dataObj[0].champion_code + ".png'" + "class='flags'>";
                                awayFlag.innerHTML = "<img src='countryFlags/" + dataObj[0].runner_up_code + ".png'" + "class='flags'>";

                                div.innerHTML = "<div>Champion: " + dataObj[0].champion + "</div><div>Runner-up: " + dataObj[0].runner_up + "</div>";

                                homeScore.innerHTML = dataObj[0].champion_score;
                                awayScore.innerHTML = dataObj[0].runner_up_score;
                               
                                //            });
                                //          div.appendChild(document.createTextNode("<div>Champion: " + dataObj.champion + "</div>" + "<div>Runner-up: " + dataObj.runner_up + "</div>");
                            }, 1000);
                        } else {
                            div.appendChild(document.createTextNode(JSON.stringify(ERROR)));
                        }
                         hTeamBox.style.opacity = '1';
                                aTeamBox.style.opacity = '1';

                        //                        s.style.WebkitTransitionDelay = "2s";
                        //                        s.style.display = "none";
                        // Append the div to the output container.
                        output.appendChild(div);
                    }
                };
            });
        });

    </script>
</body>

</html>
